DROP DATABASE IF EXISTS 5025241127_Mochammad_Irfan_Sandy_Assignment_1;
CREATE DATABASE 5025241127_Mochammad_Irfan_Sandy_Assignment_1;
USE 5025241127_Mochammad_Irfan_Sandy_Assignment_1;

CREATE TABLE JENIS_LAYANAN(
    JL_ID VARCHAR(5) NOT NULL,
    JL_NAMA VARCHAR(100) NOT NULL,
    JL_HARGA DECIMAL(8, 2) NOT NULL,
    PRIMARY KEY (JL_ID)
);

CREATE TABLE KARYAWAN(
    K_ID CHAR(2) NOT NULL,
    K_NAMA VARCHAR(100) NOT NULL,
    K_BAGIAN VARCHAR(25),
    K_TGLMASUK DATE,
    K_EMAIL VARCHAR(100) NOT NULL,
    K_PASSWORD VARCHAR(100) NOT NULL,
    K_MANAGER_ID CHAR(2),
    PRIMARY KEY (K_ID),
    FOREIGN KEY (K_MANAGER_ID) REFERENCES KARYAWAN(K_ID)
);

CREATE TABLE PELANGGAN(
    P_NO CHAR(5) NOT NULL,
    P_NAMA VARCHAR(60) NOT NULL,
    P_JENISKEL CHAR(1),
    P_TEMPATLAHIR VARCHAR(30),
    P_TGLLAHIR DATE,
    P_ALAMAT VARCHAR(200),
    P_NOTELP VARCHAR(15),
    P_TGLDAFTAR DATE NOT NULL,
    PRIMARY KEY (P_NO)
);

CREATE TABLE NOTA(
    N_NO INT NOT NULL,
    N_TGLMASUK DATE NOT NULL,
    N_TGLPERKIRAANSELESAI DATE NOT NULL,
    N_TGLSELESAI DATE,
    N_TGLAMBIL TIMESTAMP,
    N_STATUS VARCHAR(10) NOT NULL,
    N_KODERAK VARCHAR(3),
    P_NO CHAR(5) NOT NULL,
    PRIMARY KEY (N_NO),
    FOREIGN KEY (P_NO) REFERENCES PELANGGAN(P_NO)
);

CREATE TABLE PAYMENT(
    B_NO INT NOT NULL,
    B_TOTALHARGA DECIMAL(10, 2) NOT NULL,
    B_TGLBAYAR DATE NOT NULL,
    N_NO INT NOT NULL,
    PRIMARY KEY (B_NO, N_NO),
    FOREIGN KEY (N_NO) REFERENCES NOTA(N_NO)
);

CREATE TABLE JENIS_LAYANAN_NOTA(
    JL_ID VARCHAR(5) NOT NULL,
    N_NO INT NOT NULL,
    PRIMARY KEY (JL_ID, N_NO),
    FOREIGN KEY (JL_ID) REFERENCES JENIS_LAYANAN(JL_ID),
    FOREIGN KEY (N_NO) REFERENCES NOTA(N_NO)
);

CREATE TABLE KARYAWAN_NOTA(
    K_ID CHAR(2) NOT NULL,
    N_NO INT NOT NULL,
    PRIMARY KEY (K_ID, N_NO),
    FOREIGN KEY (K_ID) REFERENCES KARYAWAN(K_ID),
    FOREIGN KEY (N_NO) REFERENCES NOTA(N_NO)
);

ALTER TABLE NOTA MODIFY COLUMN N_TGLAMBIL DATE;

ALTER TABLE NOTA DROP COLUMN N_KODERAK;

ALTER TABLE PAYMENT ADD COLUMN B_PAYMENT_INFORMATION VARCHAR(255);

INSERT INTO JENIS_LAYANAN (JL_ID, JL_NAMA, JL_HARGA) VALUES
('JL001', 'Cuci Reguler', 15000.00),
('JL002', 'Cuci Express', 25000.00),
('JL003', 'Dry Clean', 50000.00),
('JL004', 'Setrika', 10000.00),
('JL005', 'Cuci Sepatu', 35000.00);

INSERT INTO KARYAWAN (K_ID, K_NAMA, K_BAGIAN, K_TGLMASUK, K_EMAIL, K_PASSWORD, K_MANAGER_ID) VALUES
('01', 'Budi Santoso', 'Manager', '2020-03-15', 'budi@laundry.com', 'password234', NULL),
('02', 'Citra Dewi', 'Setrika', '2021-04-20', 'citra@laundry.com', 'password345', '01'),
('03', 'Dian Purnama', 'Kasir', '2022-05-10', 'dian@laundry.com', 'password456', '01'),
('04', 'Andi Rianto', 'Cuci', '2020-06-18', 'andi@laundry.com', 'password123', '01'),
('05', 'Eko Prasetyo', 'Cuci', '2022-07-01', 'eko@laundry.com', 'password567', '01');

INSERT INTO PELANGGAN (P_NO, P_NAMA, P_JENISKEL, P_TEMPATLAHIR, P_TGLLAHIR, P_ALAMAT, P_NOTELP, P_TGLDAFTAR) VALUES
('P0001', 'Delilah', 'P', 'Jakarta', '1990-05-15', 'Jl. Mawar No. 10', '081234567890', '2023-01-01'),
('P0002', 'Farhan Ahmad', 'L', 'Bandung', '1988-11-20', 'Jl. Melati No. 5', '082345678901', '2023-02-15'),
('P0003', 'Gita Nirmala', 'P', 'Surabaya', '1995-07-30', 'Jl. Anggrek No. 8', '083456789012', '2023-03-20'),
('P0004', 'Hadi Kusuma', 'L', 'Yogyakarta', '1992-09-10', 'Jl. Dahlia No. 12', '084567890123', '2023-04-05'),
('P0005', 'Indah Pertiwi', 'P', 'Semarang', '1993-12-25', 'Jl. Tulip No. 3', '085678901234', '2023-05-10');

INSERT INTO NOTA (N_NO, N_TGLMASUK, N_TGLPERKIRAANSELESAI, N_TGLSELESAI, N_TGLAMBIL, N_STATUS, P_NO) VALUES
(1, '2023-10-13', '2023-10-15', '2023-10-15', '2023-10-15', 'Selesai', 'P0001'),
(2, '2023-10-14', '2023-10-16', '2023-10-16', NULL, 'Proses', 'P0002'),
(3, '2023-10-15', '2023-10-17', NULL, NULL, 'Baru', 'P0003'),
(4, '2023-10-16', '2023-10-18', NULL, NULL, 'Baru', 'P0004'),
(5, '2023-10-17', '2023-10-19', NULL, NULL, 'Baru', 'P0005');

INSERT INTO PAYMENT (B_NO, B_TOTALHARGA, B_TGLBAYAR, N_NO, B_PAYMENT_INFORMATION) VALUES
(1, 75000.00, '2023-10-15', 1, 'Cash'),
(2, 100000.00, '2023-10-14', 2, 'Debit'),
(3, 50000.00, '2023-10-15', 3, 'Cash'),
(4, 85000.00, '2023-10-16', 4, 'Loan'),
(5, 60000.00, '2023-10-17', 5, 'QRIS');

INSERT INTO JENIS_LAYANAN_NOTA (JL_ID, N_NO) VALUES
('JL001', 1),
('JL002', 2),
('JL003', 3),
('JL004', 4),
('JL005', 5);

INSERT INTO KARYAWAN_NOTA (K_ID, N_NO) VALUES
('01', 1),
('02', 2),
('03', 3),
('04', 4),
('05', 5);

UPDATE PAYMENT SET `B_TOTALHARGA` = `B_TOTALHARGA` * 0.9 WHERE B_TGLBAYAR = '2023-10-15';

UPDATE PELANGGAN SET `P_NOTELP` = '0811839034' WHERE `P_NAMA` = 'Delilah';

DELETE FROM KARYAWAN_NOTA WHERE `K_ID` = (SELECT `K_ID` FROM KARYAWAN WHERE `K_NAMA` = 'Andi Rianto');
DELETE FROM KARYAWAN WHERE `K_NAMA` = 'Andi Rianto';